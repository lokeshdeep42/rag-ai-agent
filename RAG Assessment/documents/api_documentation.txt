API DOCUMENTATION - CloudSync REST API
======================================

Version: 2.0
Last Updated: January 2024
Base URL: https://api.cloudsync.com/v2

TABLE OF CONTENTS
1. Getting Started
2. Authentication
3. Rate Limiting
4. File Operations
5. Folder Operations
6. Sharing and Permissions
7. User Management
8. Webhooks
9. Error Handling
10. Code Examples

---

1. GETTING STARTED
===================

1.1 API Overview
----------------
The CloudSync REST API allows developers to integrate CloudSync functionality into their applications. The API follows RESTful principles and uses JSON for request and response payloads.

Key Features:
- Upload and download files
- Manage folders and file organization
- Create and manage shared links
- User and permission management
- Real-time webhooks for file changes
- Comprehensive metadata access

1.2 API Endpoint
----------------
All API requests should be made to:
https://api.cloudsync.com/v2

1.3 API Keys
------------
To use the API, you need an API key. Generate one from your account settings:

1. Log in to CloudSync
2. Go to Settings > Developer
3. Click "Generate API Key"
4. Copy and securely store your API key

IMPORTANT: Keep your API key secret. Do not share it or commit it to version control.

---

2. AUTHENTICATION
==================

2.1 API Key Authentication
---------------------------
Include your API key in the Authorization header of every request:

Authorization: Bearer YOUR_API_KEY

Example:
```
GET /files
Host: api.cloudsync.com
Authorization: Bearer sk_live_abc123def456ghi789
```

2.2 OAuth 2.0 Authentication
-----------------------------
For applications that need to access user data on their behalf, use OAuth 2.0.

Authorization URL:
https://cloudsync.com/oauth/authorize

Token URL:
https://api.cloudsync.com/oauth/token

Supported grant types:
- authorization_code
- refresh_token

Required scopes:
- files.read - Read file metadata and content
- files.write - Upload and modify files
- files.delete - Delete files
- sharing.read - View shared links
- sharing.write - Create and modify shared links
- account.read - Read account information

---

3. RATE LIMITING
=================

3.1 Rate Limits by Plan
------------------------
- Free Plan: 1,000 requests/day
- Personal Plan: 10,000 requests/day
- Professional Plan: 100,000 requests/day
- Business Plan: 1,000,000 requests/day
- Enterprise Plan: Unlimited

3.2 Rate Limit Headers
----------------------
Every API response includes rate limit information:

X-RateLimit-Limit: 10000
X-RateLimit-Remaining: 9850
X-RateLimit-Reset: 1640995200

3.3 Handling Rate Limits
-------------------------
If you exceed your rate limit, you'll receive a 429 Too Many Requests response:

```json
{
  "error": "rate_limit_exceeded",
  "message": "API rate limit exceeded",
  "retry_after": 3600
}
```

Wait for the time specified in retry_after (seconds) before making more requests.

---

4. FILE OPERATIONS
===================

4.1 List Files
--------------
GET /files

List all files in your account or a specific folder.

Query Parameters:
- folder_id (optional): ID of folder to list files from
- limit (optional): Number of results per page (default: 100, max: 1000)
- offset (optional): Pagination offset
- sort (optional): Sort field (name, modified, size)
- order (optional): Sort order (asc, desc)

Example Request:
```
GET /files?folder_id=fld_abc123&limit=50&sort=modified&order=desc
Authorization: Bearer YOUR_API_KEY
```

Example Response:
```json
{
  "files": [
    {
      "id": "file_xyz789",
      "name": "document.pdf",
      "size": 1048576,
      "mime_type": "application/pdf",
      "created_at": "2024-01-15T10:30:00Z",
      "modified_at": "2024-01-15T14:20:00Z",
      "folder_id": "fld_abc123",
      "path": "/Documents/document.pdf",
      "download_url": "https://dl.cloudsync.com/xyz789",
      "thumbnail_url": "https://thumb.cloudsync.com/xyz789"
    }
  ],
  "total": 150,
  "limit": 50,
  "offset": 0,
  "has_more": true
}
```

4.2 Get File Metadata
----------------------
GET /files/{file_id}

Retrieve detailed metadata for a specific file.

Example Request:
```
GET /files/file_xyz789
Authorization: Bearer YOUR_API_KEY
```

Example Response:
```json
{
  "id": "file_xyz789",
  "name": "document.pdf",
  "size": 1048576,
  "mime_type": "application/pdf",
  "created_at": "2024-01-15T10:30:00Z",
  "modified_at": "2024-01-15T14:20:00Z",
  "folder_id": "fld_abc123",
  "path": "/Documents/document.pdf",
  "download_url": "https://dl.cloudsync.com/xyz789",
  "hash": "sha256:abc123...",
  "version": 3,
  "shared": false,
  "permissions": {
    "can_read": true,
    "can_write": true,
    "can_delete": true,
    "can_share": true
  }
}
```

4.3 Upload File
---------------
POST /files/upload

Upload a new file or new version of existing file.

Request Headers:
- Content-Type: multipart/form-data

Form Parameters:
- file (required): File content
- folder_id (optional): Destination folder ID
- name (optional): Custom filename
- overwrite (optional): Overwrite if exists (true/false)

Example Request:
```
POST /files/upload
Authorization: Bearer YOUR_API_KEY
Content-Type: multipart/form-data

--boundary
Content-Disposition: form-data; name="file"; filename="document.pdf"
Content-Type: application/pdf

[file content]
--boundary
Content-Disposition: form-data; name="folder_id"

fld_abc123
--boundary--
```

Example Response:
```json
{
  "id": "file_new123",
  "name": "document.pdf",
  "size": 1048576,
  "mime_type": "application/pdf",
  "created_at": "2024-01-16T09:00:00Z",
  "folder_id": "fld_abc123",
  "path": "/Documents/document.pdf",
  "download_url": "https://dl.cloudsync.com/new123"
}
```

4.4 Download File
-----------------
GET /files/{file_id}/download

Download file content.

Example Request:
```
GET /files/file_xyz789/download
Authorization: Bearer YOUR_API_KEY
```

Response: Binary file content with appropriate Content-Type header

4.5 Delete File
---------------
DELETE /files/{file_id}

Delete a file permanently.

Example Request:
```
DELETE /files/file_xyz789
Authorization: Bearer YOUR_API_KEY
```

Example Response:
```json
{
  "deleted": true,
  "id": "file_xyz789"
}
```

4.6 Copy File
-------------
POST /files/{file_id}/copy

Create a copy of a file.

Request Body:
```json
{
  "destination_folder_id": "fld_def456",
  "name": "document_copy.pdf"
}
```

Example Response:
```json
{
  "id": "file_copy123",
  "name": "document_copy.pdf",
  "folder_id": "fld_def456",
  "path": "/Archive/document_copy.pdf"
}
```

4.7 Move File
-------------
POST /files/{file_id}/move

Move a file to a different folder.

Request Body:
```json
{
  "destination_folder_id": "fld_def456"
}
```

---

5. FOLDER OPERATIONS
=====================

5.1 Create Folder
-----------------
POST /folders

Create a new folder.

Request Body:
```json
{
  "name": "New Folder",
  "parent_folder_id": "fld_root"
}
```

Example Response:
```json
{
  "id": "fld_new123",
  "name": "New Folder",
  "parent_folder_id": "fld_root",
  "path": "/New Folder",
  "created_at": "2024-01-16T10:00:00Z"
}
```

5.2 List Folder Contents
-------------------------
GET /folders/{folder_id}/contents

List all files and subfolders in a folder.

Example Response:
```json
{
  "folders": [
    {
      "id": "fld_sub123",
      "name": "Subfolder",
      "item_count": 5
    }
  ],
  "files": [
    {
      "id": "file_abc123",
      "name": "document.pdf",
      "size": 1048576
    }
  ]
}
```

5.3 Delete Folder
-----------------
DELETE /folders/{folder_id}

Delete a folder and all its contents.

Query Parameters:
- recursive (required): Must be true to delete non-empty folder

---

6. SHARING AND PERMISSIONS
============================

6.1 Create Share Link
----------------------
POST /files/{file_id}/share

Create a shareable link for a file.

Request Body:
```json
{
  "permission": "view",
  "expires_at": "2024-12-31T23:59:59Z",
  "password": "optional_password"
}
```

Example Response:
```json
{
  "share_id": "shr_abc123",
  "url": "https://cloudsync.com/s/abc123",
  "permission": "view",
  "expires_at": "2024-12-31T23:59:59Z",
  "password_protected": true
}
```

6.2 List Shared Links
----------------------
GET /shares

List all active shared links.

6.3 Revoke Share Link
----------------------
DELETE /shares/{share_id}

Revoke a shared link.

---

7. USER MANAGEMENT
===================

7.1 Get Current User
--------------------
GET /user

Get information about the authenticated user.

Example Response:
```json
{
  "id": "usr_abc123",
  "email": "user@example.com",
  "name": "John Doe",
  "plan": "professional",
  "storage_used": 52428800,
  "storage_quota": 1099511627776,
  "created_at": "2023-01-01T00:00:00Z"
}
```

7.2 Update User Profile
-----------------------
PATCH /user

Update user profile information.

---

8. WEBHOOKS
============

8.1 Create Webhook
------------------
POST /webhooks

Register a webhook endpoint to receive real-time notifications.

Request Body:
```json
{
  "url": "https://your-app.com/webhook",
  "events": ["file.created", "file.updated", "file.deleted"],
  "secret": "your_webhook_secret"
}
```

8.2 Webhook Events
------------------
- file.created - New file uploaded
- file.updated - File modified
- file.deleted - File deleted
- folder.created - New folder created
- share.created - New share link created

8.3 Webhook Payload
-------------------
```json
{
  "event": "file.created",
  "timestamp": "2024-01-16T10:30:00Z",
  "data": {
    "file_id": "file_xyz789",
    "name": "document.pdf",
    "size": 1048576
  }
}
```

---

9. ERROR HANDLING
==================

9.1 Error Response Format
--------------------------
```json
{
  "error": "error_code",
  "message": "Human-readable error message",
  "details": {
    "field": "Additional error details"
  }
}
```

9.2 Common Error Codes
-----------------------
- 400 Bad Request - Invalid request parameters
- 401 Unauthorized - Invalid or missing API key
- 403 Forbidden - Insufficient permissions
- 404 Not Found - Resource not found
- 409 Conflict - Resource conflict (e.g., duplicate name)
- 429 Too Many Requests - Rate limit exceeded
- 500 Internal Server Error - Server error
- 503 Service Unavailable - Service temporarily unavailable

---

10. CODE EXAMPLES
==================

10.1 Python Example
-------------------
```python
import requests

API_KEY = "your_api_key"
BASE_URL = "https://api.cloudsync.com/v2"

headers = {
    "Authorization": f"Bearer {API_KEY}"
}

# List files
response = requests.get(f"{BASE_URL}/files", headers=headers)
files = response.json()

# Upload file
with open("document.pdf", "rb") as f:
    files = {"file": f}
    response = requests.post(
        f"{BASE_URL}/files/upload",
        headers=headers,
        files=files
    )
    print(response.json())
```

10.2 JavaScript Example
------------------------
```javascript
const API_KEY = 'your_api_key';
const BASE_URL = 'https://api.cloudsync.com/v2';

// List files
fetch(`${BASE_URL}/files`, {
  headers: {
    'Authorization': `Bearer ${API_KEY}`
  }
})
.then(response => response.json())
.then(data => console.log(data));

// Upload file
const formData = new FormData();
formData.append('file', fileInput.files[0]);

fetch(`${BASE_URL}/files/upload`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${API_KEY}`
  },
  body: formData
})
.then(response => response.json())
.then(data => console.log(data));
```

---

SUPPORT
=======

For API support:
- Documentation: https://developers.cloudsync.com
- API Status: https://status.cloudsync.com
- Support Email: api-support@cloudsync.com
- Developer Forum: https://forum.cloudsync.com

For bug reports or feature requests:
- GitHub: https://github.com/cloudsync/api-issues
